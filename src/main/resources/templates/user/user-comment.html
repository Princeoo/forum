<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:v-on="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>用户中心-KuangStudy</title>
    <link rel="stylesheet" th:href="@{/bootstrap/css/bootstrap.min.css}">
    <style>
        #table-title tr th{
            border: none;
        }
        #commentListA a{
            max-width: 400px;
            white-space: nowrap; /* 不换行 */
            overflow: hidden; /* 超出部分不显示 */
            text-overflow: ellipsis; /* 超出部分显示为... */
        }
    </style>
</head>
<body style="background: #f2f2f2;">

<div th:replace="~{common/header::header(activeUrl='user')}"></div>

<main role="main" class="container">
    <div class="row" id="vueList">

        <div th:replace="~{user/index::userShowPanel}"></div>

        <div class="col-md-9 blog-main">

            <div class="my-3 p-3 bg-white rounded shadow-sm">
                <input type="hidden" name="refAuthorId" id="refAuthorId" ref="refAuthorId"
                       th:value="${session.loginUser.getUid()}">


                <h6 class="border-bottom border-gray pb-2 mb-0">
                    <nav class="nav nav-pills">
                        <a class="nav-link"
                           th:href="@{'/jump/user'}">
                            <svg class="bi bi-receipt-cutoff" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" d="M1.92.506a.5.5 0 0 1 .434.14L3 1.293l.646-.647a.5.5 0 0 1 .708 0L5 1.293l.646-.647a.5.5 0 0 1 .708 0L7 1.293l.646-.647a.5.5 0 0 1 .708 0L9 1.293l.646-.647a.5.5 0 0 1 .708 0l.646.647.646-.647a.5.5 0 0 1 .708 0l.646.647.646-.647a.5.5 0 0 1 .801.13l.5 1A.5.5 0 0 1 15 2v13h-1V2.118l-.137-.274-.51.51a.5.5 0 0 1-.707 0L12 1.707l-.646.647a.5.5 0 0 1-.708 0L10 1.707l-.646.647a.5.5 0 0 1-.708 0L8 1.707l-.646.647a.5.5 0 0 1-.708 0L6 1.707l-.646.647a.5.5 0 0 1-.708 0L4 1.707l-.646.647a.5.5 0 0 1-.708 0l-.509-.51L2 2.118V15H1V2a.5.5 0 0 1 .053-.224l.5-1a.5.5 0 0 1 .367-.27zM0 15.5a.5.5 0 0 1 .5-.5h15a.5.5 0 0 1 0 1H.5a.5.5 0 0 1-.5-.5z"/>
                                <path fill-rule="evenodd" d="M3 4.5a.5.5 0 0 1 .5-.5h6a.5.5 0 1 1 0 1h-6a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h6a.5.5 0 1 1 0 1h-6a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h6a.5.5 0 1 1 0 1h-6a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 0 1h-6a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 0 1h-6a.5.5 0 0 1-.5-.5zm8-8a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 0 1h-1a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 0 1h-1a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 0 1h-1a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 0 1h-1a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 0 1h-1a.5.5 0 0 1-.5-.5z"/>
                            </svg>
                            博客
                        </a>
                        <a class="nav-link active"
                           th:href="@{'/jump/user/comment'}">
                            <svg class="bi bi-chat-dots" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" d="M2.678 11.894a1 1 0 0 1 .287.801 10.97 10.97 0 0 1-.398 2c1.395-.323 2.247-.697 2.634-.893a1 1 0 0 1 .71-.074A8.06 8.06 0 0 0 8 14c3.996 0 7-2.807 7-6 0-3.192-3.004-6-7-6S1 4.808 1 8c0 1.468.617 2.83 1.678 3.894zm-.493 3.905a21.682 21.682 0 0 1-.713.129c-.2.032-.352-.176-.273-.362a9.68 9.68 0 0 0 .244-.637l.003-.01c.248-.72.45-1.548.524-2.319C.743 11.37 0 9.76 0 8c0-3.866 3.582-7 8-7s8 3.134 8 7-3.582 7-8 7a9.06 9.06 0 0 1-2.347-.306c-.52.263-1.639.742-3.468 1.105z"/>
                                <path d="M5 8a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm4 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm4 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"/>
                            </svg>
                            回复
                        </a>
                    </nav>
                </h6>

                <div id="commentListA" v-for="result in results.commentList" class="media text-muted pt-3">
                    <input type="hidden" name="forumId" id="forumId" ref="forumId" :value="(result.id)">
                    <!-- 头像 -->
                    <img :src="(results.avatar)"  style="border-radius: 5px " width="32" height="32">
<!--                    th:src="${comment.getUserAvatar()}"-->
                    <p class="media-body pb-3 mb-0 small lh-125 border-bottom border-gray" style="margin-left: 5px">
                        <!-- 评论内容 -->
                        <a class="text-dark font-weight-bold text-decoration-none d-block">
                            &nbsp;{{result.content}}
                        </a>

                        <!-- 时间 -->
                        <span class="badge badge-light">
                            {{dateFormat(result.createTime)}}
                        </span>

                        <a
                           class="badge badge-danger float-right" style="color: white" href="/jump/user/comment"
                           v-on:click="deleteForum((result.id))">
<!--                            th:href="'/user/comment/delete/'+${comment.getUserId()}+'/'+${comment.getCommentId()}"-->
                           删除
                        </a>
                    </p>
                </div>

                <!--分页-->
                <nav aria-label="Page navigation example" class="mt-4">
                    <ul class="pagination justify-content-center pagination-sm">
                        <li v-if="(results.current) != 1">
                            <a class="page-link"  v-on:click="Previous()" tabindex="">Previous</a>
                        </li>
                        <li class="page-item" v-if="(results.current) != 1">
                            <a class="page-link" v-on:click="Previous()">
                                {{(results.current)-1}}
                            </a>
                        </li>
                        <li class="page-item active">
                            <a class="page-link" v-on:click="postApiData()" >
                                {{(results.current)}}
                            </a>
                        </li>
                        <li class="page-item" >
                            <a class="page-link"  v-on:click="Next()" >
                                {{(results.current)+1}}
                            </a>
                        </li>
                        <li >
                            <a class="page-link"  v-on:click="Next()" >Next</a>
                        </li>
                    </ul>
                </nav>

            </div>
        </div>
    </div>

</main>


<div th:replace="~{common/footer::footer}"></div>

<a class="to-top">返回顶部</a>
<script th:src="@{/js/vue.min.js}"></script>
<script th:src="@{/js/axios.min.js}"></script>
<script th:src="@{/js/jquery-3.5.1.min.js}"></script>
<script th:src="@{/bootstrap/js/bootstrap.bundle.min.js}"></script>
<script th:src="@{/js/toTop.js}"></script>

<!-- layer 赞赏码 -->
<script th:src="@{/layer/layer.js}"></script>
<script th:src="@{/js/axios.js}"></script>

<script>
    // 后台读取
    function donate(){
        axios.get('/user/donate/1').then(response => {
            console.log()
            layer.photos({
                photos: response.data,
                anim: 5 //0-6的选择，指定弹出图片动画类型，默认随机（请注意，3.0之前的版本用shift参数）
            })
        })
    }

    var user_id = document.getElementById('refAuthorId').value

    new Vue({
      el:'#vueList',
      data:{
        results: []  //搜索的结果
      },
      methods: {
        // getInfo() {
        //   // //对接后端接口
        //   axios.get('/forum').then(response=>{
        //     this.results = response.data
        //   })
        //
        // },
        getForumByUid() {
          // //对接后端接口
          axios.get('/forum-comment/'+user_id).then(response=>{
            this.results = response.data
            console.log(this.results)
          })

        },
        Previous() {
          // //对接后端接口
          axios.get('/forum/page/'+parseInt(this.results.current-1)+'/10').then(response=>{
            this.results = response.data
          })

        },
        Next() {
          // //对接后端接口
          axios.get('/forum/page/'+parseInt(this.results.current+1) +'/10').then(response=>{
            this.results = response.data
          })

        },
        deleteForum:function(id) {
          if(confirm('你确认要删除吗？')) {
            // //对接后端接口
            axios.get('/forum-comment/deleteCommentByBid/'+ id).then(response => {
              this.results = response.data
              alert(this.results.msg)
            })
          }
        },
        //时间格式化函数，此处仅针对yyyy-MM-dd hh:mm:ss 的格式进行格式化
        dateFormat:function(time) {
          var date=new Date(time)
          var year=date.getFullYear()
          /* 在日期格式中，月份是从0开始的，因此要加0
           * 使用三元表达式在小于10的前面加0，以达到格式统一  如 09:11:05
           * */
          var month= date.getMonth()+1<10 ? '0'+(date.getMonth()+1) : date.getMonth()+1
          var day=date.getDate()<10 ? '0'+date.getDate() : date.getDate()
          var hours=date.getHours()<10 ? '0'+date.getHours() : date.getHours()
          var minutes=date.getMinutes()<10 ? '0'+date.getMinutes() : date.getMinutes()
          var seconds=date.getSeconds()<10 ? '0'+date.getSeconds() : date.getSeconds()
          // 拼接
          return year+'-'+month+'-'+day+' '+hours+':'+minutes+':'+seconds
        }
      },
      mounted(){
        this.getForumByUid()
      }



    })
</script>

</body>
</html>